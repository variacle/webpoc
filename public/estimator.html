<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Variacle â€” Encrypt (RSA-OAEP/SHA-256)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:0;padding:20px;max-width:980px}
    h2{margin:0 0 12px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    textarea{width:100%;height:140px;font-family:ui-monospace,Menlo,Consolas,monospace}
    .row{margin:12px 0}
    button{padding:8px 12px;margin-right:8px}
    .out{font-size:1.05rem;word-break:break-all}
    small{color:#666}
    .card{border:1px solid #e5e7eb;border-radius:8px;padding:12px;margin-top:12px}
    input[type=file]{margin-top:6px}
    code{background:#f6f8fa;padding:2px 6px;border-radius:4px}
  </style>
</head>
<body>
  <h2>Variacle â€” compute estimators locally and encrypt</h2>
  <p>Paste values separated by <strong>spaces</strong>. Everything runs in your browser.</p>

  <div class="card">
    <label><strong>Dataset (CSV with columns A,Y)</strong></label>
    <input id="csvFile" type="file" accept=".csv">
    <small>Upload a CSV containing two columns named <code>A</code> and <code>Y</code>.</small>
  </div>

  <textarea id="pubPem" style="display:none;">-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCrB4TpLW8nFLs+TCr+LtkXWEe2
dDjI3/SizL97X/Frl2BNi84QsyIyDcQtt9sPCtKqgl+e/2oJLzRCLib0qjVIXi2o
/vGZiIBmm9nrA4siyL5UwNtXTs3dtTpagwzS/LW6RCVfuP2tN0269GzGU2InArQq
F9/33xBuQyMOClZEzQIDAQAB
-----END PUBLIC KEY-----</textarea>

  <div class="row">
    <button id="compute">Compute & Encrypt</button>
    <button id="copy">Copy Ciphertext</button>
  </div>

  <div class="card out">
    <div><strong>Ciphertext (Base64, RSA-OAEP/SHA-256):</strong></div>
    <div id="cipher">â€”</div>
  </div>

  <!-- ðŸ”¸ SCRIPT THAT INCLUDES BASE64-ENCODED WASM -->
  <script>
  (async () => {
    // ðŸ”¸ PASTE YOUR BASE64 STRING BETWEEN THE BACKTICKS BELOW
    const wasmB64 = `
    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bWVpeGlkZS8uY2FyZ28vcmVnaXN0cnkvc3JjL2luZGV4LmNyYXRlcy5pby0xOTQ5Y2Y4YzZiNWI1NTdmL3dhc20tYmluZGdlbi0wLjIuMTA0L3NyYy9jb252ZXJ0L3NsaWNlcy5ycwAvVXNlcnMvY2dtZWl4aWRlLy5jYXJnby9yZWdpc3RyeS9zcmMvaW5kZXguY3JhdGVzLmlvLTE5NDljZjhjNmI1YjU1N2Yvd2FzbS1iaW5kZ2VuLTAuMi4xMDQvc3JjL2V4dGVybnJlZi5ycwAvcnVzdC9kZXBzL2RsbWFsbG9jLTAuMi4xMC9zcmMvZGxtYWxsb2MucnMAPAAQAHAAAAAjAQAADgAAAGNsb3N1cmUgaW52b2tlZCByZWN1cnNpdmVseSBvciBhZnRlciBiZWluZyBkcm9wcGVkYXNzZXJ0aW9uIGZhaWxlZDogcHNpemUgPj0gc2l6ZSArIG1pbl9vdmVyaGVhZBkBEAAqAAAAsQQAAAkAAABhc3NlcnRpb24gZmFpbGVkOiBwc2l6ZSA8PSBzaXplICsgbWF4X292ZXJoZWFkAAAZARAAKgAAALcEAAANAAAArQAQAGsAAAB+AAAAEQAAAK0AEABrAAAAiwAAABEAQaSEwAALAQQAcAlwcm9kdWNlcnMCCGxhbmd1YWdlAQRSdXN0AAxwcm9jZXNzZWQtYnkDBXJ1c3RjHTEuOTAuMCAoMTE1OWU3OGM0IDIwMjUtMDktMTQpBndhbHJ1cwYwLjIzLjMMd2FzbS1iaW5kZ2VuBzAuMi4xMDQAaw90YXJnZXRfZmVhdHVyZXMGKw9tdXRhYmxlLWdsb2JhbHMrE25vbnRyYXBwaW5nLWZwdG9pbnQrC2J1bGstbWVtb3J5KwhzaWduLWV4dCsPcmVmZXJlbmNlLXR5cGVzKwptdWx0aXZhbHVl`;

    // Decode Base64 -> ArrayBuffer
    const wasmBytes = Uint8Array.from(atob(wasmB64.replace(/\s+/g,'')), c => c.charCodeAt(0));

   // Instantiate WASM module with full stub imports expected by wasm-bindgen
// --- Fully compatible wasm-bindgen import object ---
const importObject = {
  wbg: {
    __wbg_getindex_dab956d53b598206: (arr, idx) => arr[idx >>> 0],
    __wbg_length_6fd3e125220cd9e2: arr => (arr ? arr.length : 0),
    __wbg_new_1f3a344cf3123716: () => [],
    __wbg_push_330b2eb93e4e1212: (arr, val) => arr.push(val),
    __wbindgen_throw: (ptr, len) => {
      throw new Error("WASM panic stub: " + ptr + ", " + len);
    },
    __wbg_wbindgenthrow_451ec1a8469d7eb6: (ptr, len) => {
      console.error("wasm-bindgen throw", ptr, len);
      throw new Error("wasm-bindgen throw");
    },
    __wbindgen_cast_d6cd19b81560fd6e: x => x,
    __wbindgen_init_externref_table: () => {},
    __wbindgen_export_0: new WebAssembly.Table({ initial: 4, element: "externref" }),
  },
};

    const { instance } = await WebAssembly.instantiate(wasmBytes.buffer, importObject);
    const wasm = instance.exports;

    // Helper for DOM
    const $ = id => document.getElementById(id);

    // CSV globals
    let csvA = null;
    let csvY = null;

    // Allow key upload from file
    $("csvFile").addEventListener("change", async (e)=>{
      const f = e.target.files?.[0];
      if(!f) return;
      const text = await f.text();
      const lines = text.trim().split(/\r?\n/);
      if(lines.length < 2) throw new Error("CSV must have header and data rows.");
      const header = lines[0].split(/[,;\t]/).map(s=>s.trim());
      const idxA = header.indexOf("A");
      const idxY = header.indexOf("Y");
      if(idxA < 0 || idxY < 0) throw new Error("CSV must contain columns named A and Y.");
      const arrA = [];
      const arrY = [];
      for(let i=1;i<lines.length;i++){
        const parts = lines[i].split(/[,;\t]/).map(s=>s.trim());
        if(parts.length <= Math.max(idxA, idxY)) continue;
        const a = Number(parts[idxA]);
        const y = Number(parts[idxY]);
        if(Number.isFinite(a) && Number.isFinite(y)){
          arrA.push(a);
          arrY.push(y);
        }
      }
      csvA = new Float64Array(arrA);
      csvY = new Float64Array(arrY);
      alert(`Loaded ${csvA.length} rows from CSV.`);
    });

    function parseNums(txt){
      const toks = txt.trim().split(/\s+/).filter(Boolean);
      if (toks.length === 0) return new Float64Array([]);
      const out = new Float64Array(toks.length);
      for (let i=0;i<toks.length;i++){
        const n = Number(toks[i]);
        if (Number.isNaN(n)) throw new Error(`Non-numeric token at position ${i+1}: "${toks[i]}"`);
        out[i] = n;
      }
      return out;
    }

    function arrayBufferToBase64(buf){
      const bytes = new Uint8Array(buf);
      let bin = "";
      for (let i=0;i<bytes.length;i++) bin += String.fromCharCode(bytes[i]);
      return btoa(bin);
    }

    function pemToArrayBuffer(pem){
      const b64 = pem.replace(/-----BEGIN PUBLIC KEY-----/g, "")
                     .replace(/-----END PUBLIC KEY-----/g, "")
                     .replace(/\s+/g, "");
      const raw = atob(b64);
      const buf = new ArrayBuffer(raw.length);
      const view = new Uint8Array(buf);
      for (let i=0;i<raw.length;i++) view[i] = raw.charCodeAt(i);
      return buf;
    }

    async function importRsaOaepPublicKey(pem){
      const spki = pemToArrayBuffer(pem);
      return await crypto.subtle.importKey(
        "spki",
        spki,
        { name: "RSA-OAEP", hash: "SHA-256" },
        false,
        ["encrypt"]
      );
    }

    async function rsaOaepEncryptString(publicKey, text){
      const enc = new TextEncoder();
      const data = enc.encode(text);
      const ciphertext = await crypto.subtle.encrypt({ name: "RSA-OAEP" }, publicKey, data);
      return arrayBufferToBase64(ciphertext);
    }

    let last = { v1:null, v2:null, v3:null, cipher:null };

    $("compute").addEventListener("click", async ()=>{
      try{
        const A = csvA;
        const Y = csvY;
        if (!A || !Y) throw new Error("Load a CSV first.");
        if (A.length===0) throw new Error("A is empty");
        if (Y.length===0) throw new Error("Y is empty");
        if (A.length !== Y.length) throw new Error(`Lengths differ: |A|=${A.length}, |Y|=${Y.length}`);

        // Call WASM function
        const [v1, v2, v3] = wasm.from_arrays(A, Y);

        const pem = $("pubPem").value.trim();
        if(!pem.includes("BEGIN PUBLIC KEY")) throw new Error("Paste a valid PEM public key (BEGIN PUBLIC KEY).");
        const pubKey = await importRsaOaepPublicKey(pem);

        const plaintext = `${v1} ${v2} ${v3}`;
        const b64 = await rsaOaepEncryptString(pubKey, plaintext);

        $("cipher").textContent = b64;
        last = { v1, v2, v3, cipher: b64 };
      }catch(e){
        console.error(e);
        alert("Error: " + (e?.message || e));
      }
    });

    $("copy").addEventListener("click", async ()=>{
      if(!last.cipher){ alert("Compute & Encrypt first."); return; }
      try{
        await navigator.clipboard.writeText(last.cipher);
        alert("Ciphertext copied to clipboard.");
      }catch(_){
        alert(last.cipher);
      }
    });
  })();
  </script>
</body>
</html>